import { dedent } from "ts-dedent";
import { executeWithResources } from "../execute";
import { upload as fileUpload } from "../file/file";
import { isAirplaneFileObject } from "../file/file_object";
/**
 * Sends a message to a Slack channel.
 * @param channelName The Slack channel to send a message to. This can be a channel name (e.g. `#general`), a channel
 * ID (e.g. `C1234567890`), or a user ID (e.g. `U1234567890`).
 * @param message The message to send. This can be a string, or a Slack message option object. The Slack message option
 * object includes the same options as the Slack API's `chat.postMessage` method.
 */
export const message = async (channelName, message, opts = {}) => {
    const { client } = opts;
    const paramValues = {
        channelName,
        message: typeof message === "string" ? dedent(message) : "",
        // @ts-ignore - ParamValues uses an index signature, which doesn't work with interfaces (see
        // https://github.com/microsoft/TypeScript/issues/15300). All the Slack types are interfaces, so rather than
        // re-defining them as types, we're ignoring the type error.
        messageOption: typeof message === "string" ? undefined : message,
    };
    return executeWithResources("airplane:slack_message", paramValues, { slack: "res00000000zteamslack" }, client);
};
/**
 * Uploads a file to a Slack channel.
 * @param channelName The Slack channel to send a message to. This can be a channel name (e.g. `#general`), a channel
 * ID (e.g. `C1234567890`), or a user ID (e.g. `U1234567890`).
 * @param uploadOption The options to use when uploading the file.
 */
export const upload = async (channelName, uploadOption, opts = {}) => {
    const { client } = opts;
    let fileURL;
    if (isAirplaneFileObject(uploadOption.payload)) {
        fileURL = uploadOption.payload.url;
    }
    else {
        const file = await fileUpload(uploadOption.payload, uploadOption.filename);
        fileURL = file.url;
    }
    return executeWithResources("airplane:slack_upload", {
        channelName,
        fileName: uploadOption.filename,
        fileURL: fileURL,
        message: uploadOption.message,
    }, { slack: "res00000000zteamslack" }, client);
};
