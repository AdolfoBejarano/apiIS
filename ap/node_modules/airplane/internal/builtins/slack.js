"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.upload = exports.message = void 0;
const ts_dedent_1 = require("ts-dedent");
const execute_1 = require("../execute");
const file_1 = require("../file/file");
const file_object_1 = require("../file/file_object");
/**
 * Sends a message to a Slack channel.
 * @param channelName The Slack channel to send a message to. This can be a channel name (e.g. `#general`), a channel
 * ID (e.g. `C1234567890`), or a user ID (e.g. `U1234567890`).
 * @param message The message to send. This can be a string, or a Slack message option object. The Slack message option
 * object includes the same options as the Slack API's `chat.postMessage` method.
 */
const message = async (channelName, message, opts = {}) => {
    const { client } = opts;
    const paramValues = {
        channelName,
        message: typeof message === "string" ? (0, ts_dedent_1.dedent)(message) : "",
        // @ts-ignore - ParamValues uses an index signature, which doesn't work with interfaces (see
        // https://github.com/microsoft/TypeScript/issues/15300). All the Slack types are interfaces, so rather than
        // re-defining them as types, we're ignoring the type error.
        messageOption: typeof message === "string" ? undefined : message,
    };
    return (0, execute_1.executeWithResources)("airplane:slack_message", paramValues, { slack: "res00000000zteamslack" }, client);
};
exports.message = message;
/**
 * Uploads a file to a Slack channel.
 * @param channelName The Slack channel to send a message to. This can be a channel name (e.g. `#general`), a channel
 * ID (e.g. `C1234567890`), or a user ID (e.g. `U1234567890`).
 * @param uploadOption The options to use when uploading the file.
 */
const upload = async (channelName, uploadOption, opts = {}) => {
    const { client } = opts;
    let fileURL;
    if ((0, file_object_1.isAirplaneFileObject)(uploadOption.payload)) {
        fileURL = uploadOption.payload.url;
    }
    else {
        const file = await (0, file_1.upload)(uploadOption.payload, uploadOption.filename);
        fileURL = file.url;
    }
    return (0, execute_1.executeWithResources)("airplane:slack_upload", {
        channelName,
        fileName: uploadOption.filename,
        fileURL: fileURL,
        message: uploadOption.message,
    }, { slack: "res00000000zteamslack" }, client);
};
exports.upload = upload;
