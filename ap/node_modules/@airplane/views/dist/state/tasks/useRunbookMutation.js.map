{"version":3,"file":"useRunbookMutation.js","sources":["../../../src/state/tasks/useRunbookMutation.ts"],"sourcesContent":["import { ParamValues, DefaultParams } from \"client/executeTask\";\nimport {\n  getRunbookFullMutation,\n  ExecuteError,\n  RefetchQuery,\n  RunbookMutation,\n} from \"components/query\";\n\nimport { useTaskOrRunbookMutation } from \"./useTaskOrRunbookMutation\";\n\nexport type RunbookMutationHookOptions<\n  TParams extends ParamValues | undefined = DefaultParams,\n> = {\n  /**\n   * The params of the runbook to execute.\n   */\n  params?: TParams;\n  /**\n   * If set, the provided tasks will be refetched on success.\n   *\n   * This can be useful if you expect the runbook mutation to invalidate data.\n   */\n  refetchTasks?: RefetchQuery | RefetchQuery[];\n  /**\n   * Callback on successful runbook execution.\n   */\n  onSuccess?: (sessionID: string) => void;\n  /**\n   * Callback on failed runbook execution.\n   */\n  onError?: (error: ExecuteError, sessionID?: string) => void;\n};\n\nexport type RunbookMutationFn<\n  TParams extends ParamValues | undefined = DefaultParams,\n> = (options?: RunbookMutationHookOptions<TParams>) => void;\n\nexport type RunbookMutationState = {\n  /**\n   * Will be true when the runbook is currently executing.\n   */\n  loading?: boolean;\n  /**\n   * Will be set with the error message if the runbook failed to execute.\n   */\n  error?: ExecuteError;\n  /**\n   * The ID of the session.\n   */\n  sessionID?: string;\n};\n\nexport type RunbookMutationResult<\n  TParams extends ParamValues | undefined = DefaultParams,\n> = {\n  /**\n   * Function that executes the runbook mutation.\n   */\n  mutate: RunbookMutationFn<TParams>;\n} & RunbookMutationState;\n\nexport const useRunbookMutation = <\n  TParams extends ParamValues | undefined = DefaultParams,\n>(\n  mutation: RunbookMutation<TParams>,\n): RunbookMutationResult<TParams> => {\n  const fullMutation = getRunbookFullMutation<TParams>(mutation);\n  const result = useTaskOrRunbookMutation<TParams, null>({\n    mutation: fullMutation,\n    type: \"RUNBOOK\",\n  });\n  switch (result.type) {\n    case \"RUNBOOK\":\n      return result.result;\n    default:\n      throw new Error(\"invalid result type\");\n  }\n};\n"],"names":["useRunbookMutation","mutation","fullMutation","getRunbookFullMutation","result","useTaskOrRunbookMutation","type","Error"],"mappings":";;AA6DaA,MAAAA,qBAAqB,CAGhCC,aACmC;AAC7BC,QAAAA,eAAeC,uBAAgCF,QAAQ;AAC7D,QAAMG,SAASC,yBAAwC;AAAA,IACrDJ,UAAUC;AAAAA,IACVI,MAAM;AAAA,EAAA,CACP;AACD,UAAQF,OAAOE,MAAI;AAAA,IACjB,KAAK;AACH,aAAOF,OAAOA;AAAAA,IAChB;AACQ,YAAA,IAAIG,MAAM,qBAAqB;AAAA,EACzC;AACF;"}