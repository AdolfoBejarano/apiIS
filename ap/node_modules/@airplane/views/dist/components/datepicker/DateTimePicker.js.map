{"version":3,"file":"DateTimePicker.js","sources":["../../../src/components/datepicker/DateTimePicker.tsx"],"sourcesContent":["import { createStyles } from \"@mantine/core\";\nimport { Calendar, DatePickerBase } from \"@mantine/dates\";\nimport { useUncontrolled } from \"@mantine/hooks\";\nimport dayjs from \"dayjs\";\nimport { forwardRef, Ref, useEffect, useState } from \"react\";\n\nimport { Divider } from \"components/divider/Divider\";\nimport { ComponentErrorBoundary } from \"components/errorBoundary/ComponentErrorBoundary\";\nimport { useCommonLayoutStyle } from \"components/layout/useCommonLayoutStyle\";\nimport { Stack } from \"components/stack/Stack\";\nimport { useDateTimePickerState } from \"state/components/datepicker/useDatePickerState\";\nimport { useRegisterFormInput } from \"state/components/form/useRegisterFormInput\";\nimport { useInput } from \"state/components/input/useInput\";\nimport { useComponentId } from \"state/components/useId\";\n\nimport {\n  DateTimePickerProps,\n  DateTimePickerComponentProps,\n} from \"./DatePicker.types\";\nimport { TimePicker } from \"./TimePicker\";\n\nconst useStyles = createStyles((theme) => {\n  return {\n    weekend: {\n      color: `${theme.colors.dark[6]} !important`,\n    },\n    selected: {\n      background: `${theme.colors.primary[5]} !important`,\n    },\n  };\n});\n\nexport const DateTimePickerComponent = forwardRef(\n  (\n    {\n      value,\n      size = \"sm\",\n      onChange,\n      width,\n      height,\n      grow,\n      className,\n      style,\n      initiallyOpened = false,\n      excludeDate,\n      clearable = false,\n      onDropdownClose,\n      ...props\n    }: DateTimePickerComponentProps,\n    ref: Ref<HTMLInputElement>,\n  ) => {\n    // Logic adapted from Mantine, and modified to include TimePicker.\n    const { classes, cx } = useStyles();\n    const { classes: layoutClasses } = useCommonLayoutStyle({\n      width,\n      height,\n      grow,\n    });\n    const [opened, setOpened] = useState(initiallyOpened);\n    const onChangeWrapper =\n      onChange &&\n      ((d: Date | null) => {\n        if (d === null) {\n          onChange(undefined);\n        } else {\n          onChange(d);\n        }\n      });\n    const [_value, setValue] = useUncontrolled<Date | null>({\n      value: value || null,\n      finalValue: null,\n      onChange: onChangeWrapper,\n    });\n    const [calendarMonth, setCalendarMonth] = useState(_value || new Date());\n    const [focused, setFocused] = useState(false);\n    const [inputState, setInputState] = useState(\n      _value ? formatDatetime(_value) : \"\",\n    );\n    const closeDropdown = () => {\n      setOpened(false);\n      onDropdownClose?.();\n    };\n\n    // Needed for useComponentState to work. However, we don't apply\n    // the change if there is focus in order to ensure free input works.\n    useEffect(() => {\n      if (!focused) {\n        setInputState(value ? formatDatetime(value) : \"\");\n      }\n    }, [value, focused]);\n\n    const onChangeCalendar = (date: Date) => {\n      if (value) {\n        date.setHours(value.getHours());\n        date.setMinutes(value.getMinutes());\n      }\n      setValue(date);\n      setInputState(formatDatetime(date));\n    };\n\n    const onChangeTimePicker = (dj: dayjs.Dayjs | undefined) => {\n      if (dj === undefined) {\n        onChange?.(undefined);\n      } else {\n        const d = dj.toDate();\n        setInputState(formatDatetime(d));\n        onChange?.(d);\n      }\n    };\n\n    const setDateFromInput = () => {\n      const date =\n        typeof inputState === \"string\" ? parseDate(inputState) : inputState;\n\n      if (dayjs(date).isValid()) {\n        setValue(date);\n        setCalendarMonth(date as Date);\n      }\n    };\n\n    return (\n      <DatePickerBase\n        ref={ref}\n        allowFreeInput\n        className={cx(layoutClasses.style, className)}\n        style={style}\n        dropdownOpened={opened}\n        setDropdownOpened={(b) => {\n          if (b) {\n            setOpened(true);\n          } else {\n            closeDropdown();\n          }\n        }}\n        onChange={(e) => {\n          setOpened(true);\n          const date = parseDate(e.target.value);\n          if (dayjs(date).isValid()) {\n            setValue(date);\n            setCalendarMonth(date);\n          }\n          setInputState(e.target.value);\n        }}\n        onClear={() => {\n          setValue(null);\n          setInputState(\"\");\n        }}\n        onBlur={(e) => {\n          setFocused(false);\n          setDateFromInput();\n        }}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") {\n            closeDropdown();\n            setDateFromInput();\n          }\n        }}\n        onFocus={(e) => {\n          setFocused(true);\n        }}\n        inputLabel={inputState}\n        clearButtonLabel=\"clear\"\n        clearable={clearable}\n        size={size}\n        {...props}\n      >\n        <Stack direction=\"row\" align=\"center\">\n          <Calendar\n            month={calendarMonth}\n            onMonthChange={setCalendarMonth}\n            value={_value || dayjs().toDate()}\n            onChange={onChangeCalendar}\n            size={size === \"lg\" || size === \"xl\" ? \"md\" : \"sm\"}\n            excludeDate={excludeDate}\n            preventFocus\n            dayClassName={(date, modifiers) =>\n              cx({\n                [classes.weekend]:\n                  modifiers.weekend &&\n                  !modifiers.outside &&\n                  !modifiers.selected &&\n                  !modifiers.disabled,\n                [classes.selected]: modifiers.selected,\n              })\n            }\n          />\n          <Divider\n            orientation=\"vertical\"\n            color=\"gray.3\"\n            sx={{ height: \"300px\" }}\n          />\n          <TimePicker\n            renderText=\"pick\"\n            value={value ? dayjs(value) : dayjs().startOf(\"d\")}\n            onChange={onChangeTimePicker}\n          />\n        </Stack>\n      </DatePickerBase>\n    );\n  },\n);\nDateTimePickerComponent.displayName = \"DateTimePickerComponent\";\n\nexport const DateTimePicker = forwardRef(\n  (props: DateTimePickerProps, ref: Ref<HTMLInputElement>) => {\n    return (\n      <ComponentErrorBoundary componentName={DISPLAY_NAME}>\n        <DateTimePickerWithoutRef {...props} innerRef={ref} />\n      </ComponentErrorBoundary>\n    );\n  },\n);\nconst DISPLAY_NAME = \"DateTimePicker\";\nDateTimePicker.displayName = DISPLAY_NAME;\n\nexport const DateTimePickerWithoutRef = (\n  props: DateTimePickerProps & { innerRef: Ref<HTMLInputElement> },\n) => {\n  const id = useComponentId(props.id);\n  const { state, dispatch } = useDateTimePickerState(id, {\n    initialState: {\n      disabled: props.disabled ?? props.defaultDisabled,\n      value: props.value ?? props.defaultValue,\n    },\n  });\n  const { inputProps } = useInput(props, state, dispatch, (v) => v);\n  useRegisterFormInput(id, \"date-picker\");\n\n  const {\n    innerRef,\n    validate: _,\n    onChange: __,\n    defaultDisabled: ___,\n    defaultValue: ____,\n    ...restProps\n  } = props;\n  return (\n    <DateTimePickerComponent ref={innerRef} {...inputProps} {...restProps} />\n  );\n};\n\nconst DATETIME_FORMAT = \"MMM D, YYYY h:mm A\";\n\nexport const formatDatetime = (date: Date | string): string => {\n  return dayjs(date).format(DATETIME_FORMAT);\n};\n\nconst parseDate = (date: string) => dayjs(date, DATETIME_FORMAT).toDate();\n"],"names":["useStyles","createStyles","theme","weekend","color","colors","dark","selected","background","primary","DateTimePickerComponent","value","size","onChange","width","height","grow","className","style","initiallyOpened","excludeDate","clearable","onDropdownClose","props","ref","classes","cx","layoutClasses","useCommonLayoutStyle","opened","setOpened","useState","onChangeWrapper","d","undefined","_value","setValue","useUncontrolled","finalValue","calendarMonth","setCalendarMonth","Date","focused","setFocused","inputState","setInputState","formatDatetime","closeDropdown","useEffect","onChangeCalendar","date","setHours","getHours","setMinutes","getMinutes","onChangeTimePicker","dj","toDate","setDateFromInput","parseDate","dayjs","isValid","b","e","target","key","modifiers","outside","disabled","startOf","displayName","DateTimePicker","forwardRef","DISPLAY_NAME","DateTimePickerWithoutRef","id","useComponentId","state","dispatch","useDateTimePickerState","initialState","defaultDisabled","defaultValue","inputProps","useInput","v","useRegisterFormInput","innerRef","validate","_","__","___","____","restProps","DATETIME_FORMAT","format"],"mappings":"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"}