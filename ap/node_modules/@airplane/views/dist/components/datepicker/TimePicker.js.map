{"version":3,"file":"TimePicker.js","sources":["../../../src/components/datepicker/TimePicker.tsx"],"sourcesContent":["import { createStyles } from \"@mantine/core\";\nimport dayjs from \"dayjs\";\nimport { useEffect, useState } from \"react\";\n\nimport { Button } from \"components/button/Button\";\nimport { ChevronDownIconSolid, ChevronUpIconSolid } from \"components/icon\";\nimport { Stack } from \"components/stack/Stack\";\nimport { Text } from \"components/text/Text\";\nimport { TextInput } from \"components/textinput/TextInput\";\n\nexport const useStyles = createStyles((theme) => ({\n  AMPMButton: {\n    border: theme.other.borderStyles.default,\n    \"&:disabled\": {\n      backgroundColor: theme.colors.gray[1],\n      color: theme.colors.gray[4],\n      border: theme.other.borderStyles.light,\n    },\n  },\n}));\n\nconst IncDec = (props: {\n  disabled?: boolean;\n  onClick: (e: React.MouseEvent<HTMLButtonElement>) => void;\n  isInc: boolean;\n  compact?: boolean;\n  byFive?: boolean;\n}) => (\n  <Button\n    variant=\"subtle\"\n    compact={props.compact}\n    disabled={props.disabled}\n    onMouseDown={(e: React.MouseEvent<HTMLButtonElement>) => e.preventDefault()}\n    onClick={props.onClick}\n  >\n    {props.isInc ? (\n      props.compact ? (\n        props.byFive ? (\n          <Text color=\"gray.4\" size=\"sm\" disableMarkdown>\n            +5\n          </Text>\n        ) : (\n          <Text color=\"gray.4\" size=\"lg\" disableMarkdown>\n            +\n          </Text>\n        )\n      ) : (\n        <ChevronUpIconSolid color=\"gray\" />\n      )\n    ) : props.compact ? (\n      props.byFive ? (\n        <Text color=\"gray.4\" size=\"sm\" disableMarkdown>\n          -5\n        </Text>\n      ) : (\n        <Text color=\"gray.4\" size=\"lg\" disableMarkdown>\n          -\n        </Text>\n      )\n    ) : (\n      <ChevronDownIconSolid color=\"gray\" />\n    )}\n  </Button>\n);\n\nconst mod = (n: number, m: number) => ((n % m) + m) % m;\n\n/**\n * TimeInput is a component that:\n * 1. Accepts user input in the form of a numeric value of: [min, max] | \"\"\n * 2. Can be incremented/decremented via buttons.\n * 3. Increment and decrement operations can cause the value to \"cycle\" around.\n * 4. The number is always \"capped\" to the range.\n * 5. The value from #1 is passed up through onChange when valid.\n * 6. If the parent value changes, the local value is updated.\n * 7. As the users types, len(input) is capped to digits by dropping leading digits.\n * 8. On blur, pad digits.\n */\nconst TimeInput = ({\n  readOnly,\n  min,\n  max,\n  preventFocus,\n  ...props\n}: {\n  value: number | undefined;\n  readOnly?: boolean;\n  min: number;\n  max: number;\n  incByFive?: boolean;\n  preventFocus: boolean;\n  onChange: (value: number) => void;\n}) => {\n  const base = max - min + 1; // number of valid digits\n  const def = mod(-min, base) + min; // the default value after the input is cleared\n  const digits = 2; // hardcoded for now, since we only support hours/minutes\n  const increment = props.incByFive ? 5 : 1;\n\n  const pad = (n: number) => String(n).padStart(digits, \"0\");\n\n  const [value, setValue] = useState(props.value);\n  const [raw, setRaw] = useState(pad(value ?? def));\n\n  useEffect(() => {\n    if (props.value !== value) {\n      setRaw(pad(props.value ?? min));\n      setValue(props.value);\n    }\n  }, [props.value, value, min]);\n\n  const onChange = (value: number | undefined) => {\n    setValue(value);\n    if (value !== undefined && value >= min && value <= max) {\n      props.onChange(value);\n    }\n  };\n\n  const onBlur = () => {\n    let v = value;\n    if (v === undefined) {\n      v = def;\n    } else if (v < min) {\n      v = min;\n    } else if (v > max) {\n      v = max;\n    }\n    setRaw(pad(v));\n    onChange(v);\n  };\n\n  return (\n    <Stack spacing={preventFocus ? 0 : \"xs\"} align=\"center\">\n      <IncDec\n        isInc\n        disabled={readOnly}\n        onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\n          const v =\n            mod((value === undefined ? def : value) - min + increment, base) +\n            min;\n          setRaw(pad(v));\n          onChange(v);\n        }}\n        byFive={props.incByFive}\n        compact={preventFocus}\n      />\n      {preventFocus ? (\n        <Text\n          size=\"xl\"\n          onMouseDown={preventFocus ? (e) => e.preventDefault() : undefined}\n          sx={{ margin: 10, minWidth: \"3ch\", textAlign: \"center\" }}\n          weight=\"bold\"\n        >\n          {raw}\n        </Text>\n      ) : (\n        <TextInput\n          value={raw}\n          disabled={readOnly}\n          size=\"lg\"\n          sx={{ width: 60 }}\n          onBlur={onBlur}\n          onMouseDown={preventFocus ? (e) => e.preventDefault() : undefined}\n          onChange={(e) => {\n            // Only allow numbers\n            let v = e.target.value.replace(/[^0-9]/g, \"\");\n            // As a user types in numbers, replace the current numbers\n            v = v.substring(Math.max(0, v.length - digits));\n\n            setRaw(v);\n            onChange(v == \"\" ? undefined : Number(v));\n          }}\n        />\n      )}\n      <IncDec\n        isInc={false}\n        disabled={readOnly}\n        onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\n          const v =\n            mod((value === undefined ? def : value) - min - increment, base) +\n            min;\n          setRaw(pad(v));\n          onChange(v);\n        }}\n        byFive={props.incByFive}\n        compact={preventFocus}\n      />\n    </Stack>\n  );\n};\n\nexport const TimePicker = (props: {\n  renderText: string;\n  value: dayjs.Dayjs | undefined;\n  onChange: (d: dayjs.Dayjs | undefined) => void;\n  readOnly?: boolean;\n}) => {\n  const hour = props.value ? mod(props.value.hour() - 1, 12) + 1 : undefined;\n  const isAM = props.value && props.value.hour() < 12;\n  const readOnly = props.readOnly;\n\n  const { classes } = useStyles();\n\n  return (\n    <Stack direction=\"row\" spacing=\"sm\" align=\"center\">\n      <TimeInput\n        value={hour}\n        readOnly={readOnly}\n        onChange={(value) => {\n          props.onChange(\n            props.value?.set(\"hours\", (isAM ? 0 : 12) + mod(value, 12)),\n          );\n        }}\n        preventFocus\n        min={1}\n        max={12}\n      />\n      <Text size=\"xl\">:</Text>\n      <TimeInput\n        value={props.value?.minute()}\n        readOnly={readOnly}\n        onChange={(value) => {\n          props.onChange(props.value?.set(\"minutes\", mod(value, 60)));\n        }}\n        preventFocus\n        incByFive\n        min={0}\n        max={59}\n      />\n      <Button\n        size=\"xs\"\n        variant=\"outline\"\n        color=\"gray\"\n        disabled={readOnly}\n        onMouseDown={(e: React.MouseEvent<HTMLButtonElement>) =>\n          e.preventDefault()\n        }\n        onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\n          props.onChange(\n            props.value?.set(\n              \"hours\",\n              isAM ? props.value.hour() + 12 : props.value.hour() - 12,\n            ),\n          );\n        }}\n        className={classes.AMPMButton}\n      >\n        {isAM ? \"AM\" : \"PM\"}\n      </Button>\n    </Stack>\n  );\n};\n"],"names":["useStyles","createStyles","theme","AMPMButton","border","other","borderStyles","default","backgroundColor","colors","gray","color","light","IncDec","props","compact","disabled","e","preventDefault","onClick","isInc","byFive","mod","n","m","TimeInput","readOnly","min","max","preventFocus","base","def","digits","increment","incByFive","pad","String","padStart","value","setValue","useState","raw","setRaw","useEffect","onChange","undefined","onBlur","v","margin","minWidth","textAlign","width","target","replace","substring","Math","length","Number","TimePicker","hour","isAM","classes","set","minute"],"mappings":"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"}