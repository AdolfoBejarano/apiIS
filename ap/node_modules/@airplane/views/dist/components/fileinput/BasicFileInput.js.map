{"version":3,"file":"BasicFileInput.js","sources":["../../../src/components/fileinput/BasicFileInput.tsx"],"sourcesContent":["import { FileInput as MantineFileInput, LoadingOverlay } from \"@mantine/core\";\nimport { AirplaneFile } from \"airplane\";\nimport { forwardRef, ReactNode, useCallback, useState } from \"react\";\n\nimport { showNotification } from \"components/notification/showNotification\";\nimport { FileInputTValue } from \"state/components/file-input/reducer\";\n\nimport { FileInputComponentProps } from \"./FileInput.types\";\nimport { useUploadAirplaneFiles } from \"./useUploadAirplaneFiles\";\n\nexport const BasicFileInputComponent = forwardRef<\n  HTMLButtonElement,\n  FileInputComponentProps\n>(\n  (\n    {\n      accept,\n      getUploadURL,\n      value,\n      onChange,\n      ...restProps\n    }: FileInputComponentProps,\n    ref: React.Ref<HTMLButtonElement>,\n  ) => {\n    const [loading, setLoading] = useState(false);\n    const { onDrop } = useUploadAirplaneFiles({\n      onChange,\n      onLoad: (file) => {\n        setLoading(false);\n        showNotification({\n          title: \"Upload successful\",\n          message: `${file.name} uploaded successfully`,\n          type: \"success\",\n        });\n      },\n      onError: (file, e) => {\n        setLoading(false);\n        showNotification({\n          title: \"Upload failed\",\n          message: `${file.name} upload failed: ${\n            (e as { message: string }).message\n          }`,\n          type: \"error\",\n        });\n      },\n      getUploadURL,\n    });\n    const onMantineChange = (f: File[] | File | null) => {\n      if (f === null) {\n        onDrop([]);\n      } else if (f instanceof File) {\n        setLoading(true);\n        onDrop([f]);\n      } else {\n        setLoading(true);\n        onDrop(f);\n      }\n    };\n    const container = useCallback(\n      (children: ReactNode) => {\n        return (\n          <div style={{ position: \"relative\" }}>\n            <LoadingOverlay visible={loading} /> {children}\n          </div>\n        );\n      },\n      [loading],\n    );\n    return (\n      <MantineFileInput\n        accept={accept?.join(\",\")}\n        value={componentValueToMantineValue(value)}\n        onChange={onMantineChange}\n        inputContainer={container}\n        {...restProps}\n        ref={ref}\n      />\n    );\n  },\n);\n\nconst componentValueToMantineValue = (\n  v: FileInputTValue,\n): File[] | File | null => {\n  if (v === undefined) {\n    return null;\n  } else if (v instanceof AirplaneFile) {\n    return new File([], v.name);\n  } else {\n    return v.map((f) => new File([], f.name));\n  }\n};\n\nBasicFileInputComponent.displayName = \"BasicFileInputComponent\";\n"],"names":["BasicFileInputComponent","accept","getUploadURL","value","onChange","restProps","ref","loading","setLoading","useState","onDrop","useUploadAirplaneFiles","onLoad","file","title","message","name","type","onError","e","onMantineChange","f","File","container","useCallback","children","position","MantineFileInput","join","componentValueToMantineValue","v","undefined","AirplaneFile","map","displayName"],"mappings":";;;;;;AAUaA,MAAAA,qDAIX,CACE;AAAA,EACEC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACA,GAAGC;AACoB,GACzBC,QACG;AACH,QAAM,CAACC,SAASC,UAAU,IAAIC,SAAS,KAAK;AACtC,QAAA;AAAA,IAAEC;AAAAA,MAAWC,uBAAuB;AAAA,IACxCP;AAAAA,IACAQ,QAASC,CAAS,SAAA;AAChBL,iBAAW,KAAK;AACC,uBAAA;AAAA,QACfM,OAAO;AAAA,QACPC,SAAU,GAAEF,KAAKG,IAAK;AAAA,QACtBC,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,IACAC,SAASA,CAACL,MAAMM,MAAM;AACpBX,iBAAW,KAAK;AACC,uBAAA;AAAA,QACfM,OAAO;AAAA,QACPC,SAAU,GAAEF,KAAKG,IAAK,mBACnBG,EAA0BJ,OAC5B;AAAA,QACDE,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,IACAf;AAAAA,EAAAA,CACD;AACKkB,QAAAA,kBAAkBA,CAACC,MAA4B;AACnD,QAAIA,MAAM,MAAM;AACdX,aAAO,CAAE,CAAA;AAAA,IAAA,WACAW,aAAaC,MAAM;AAC5Bd,iBAAW,IAAI;AACR,aAAA,CAACa,CAAC,CAAC;AAAA,IAAA,OACL;AACLb,iBAAW,IAAI;AACfE,aAAOW,CAAC;AAAA,IACV;AAAA,EAAA;AAEIE,QAAAA,YAAYC,YAChB,CAACC,aAAwB;AAErB,WAAA,qBAAC,SAAI,OAAO;AAAA,MAAEC,UAAU;AAAA,IACtB,GAAA,UAAA;AAAA,MAAC,oBAAA,gBAAA,EAAe,SAASnB,QAAQ,CAAA;AAAA,MAAG;AAAA,MAAEkB;AAAAA,IACxC,EAAA,CAAA;AAAA,EAAA,GAGJ,CAAClB,OAAO,CACV;AACA,6BACGoB,WACC,EAAA,QAAQ1B,iCAAQ2B,KAAK,MACrB,OAAOC,6BAA6B1B,KAAK,GACzC,UAAUiB,iBACV,gBAAgBG,WACZlB,GAAAA,WACJ,IACA,CAAA;AAEN,CACF;AAEA,MAAMwB,+BAA+BA,CACnCC,MACyB;AACzB,MAAIA,MAAMC,QAAW;AACZ,WAAA;AAAA,EAAA,WACED,aAAaE,cAAc;AACpC,WAAO,IAAIV,KAAK,CAAA,GAAIQ,EAAEd,IAAI;AAAA,EAAA,OACrB;AACEc,WAAAA,EAAEG,IAAKZ,CAAM,MAAA,IAAIC,KAAK,IAAID,EAAEL,IAAI,CAAC;AAAA,EAC1C;AACF;AAEAhB,wBAAwBkC,cAAc;"}