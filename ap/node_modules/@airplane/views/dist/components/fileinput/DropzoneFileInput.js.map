{"version":3,"file":"DropzoneFileInput.js","sources":["../../../src/components/fileinput/DropzoneFileInput.tsx"],"sourcesContent":["import { createStyles, Input, Progress } from \"@mantine/core\";\nimport { Dropzone } from \"@mantine/dropzone\";\nimport { AirplaneFile } from \"airplane\";\nimport prettyBytes from \"pretty-bytes\";\nimport { forwardRef, Ref } from \"react\";\n\nimport { Card } from \"components/card/Card\";\nimport {\n  ArrowUpTrayIcon,\n  DocumentCheckIconOutline,\n  XMarkIcon,\n} from \"components/icon\";\nimport { showNotification } from \"components/notification/showNotification\";\nimport { Stack } from \"components/stack/Stack\";\nimport { Text } from \"components/text/Text\";\nimport { COLORS } from \"components/theme/colors\";\n\nimport { FileInputComponentProps } from \"./FileInput.types\";\nimport { useUploadAirplaneFiles } from \"./useUploadAirplaneFiles\";\n\nconst useStyles = createStyles((theme) => ({\n  disabled: {\n    backgroundColor:\n      theme.colorScheme === \"dark\"\n        ? theme.colors.dark[6]\n        : theme.colors.gray[0],\n    borderColor:\n      theme.colorScheme === \"dark\"\n        ? theme.colors.dark[5]\n        : theme.colors.gray[2],\n    cursor: \"not-allowed\",\n\n    \"& *\": {\n      color:\n        theme.colorScheme === \"dark\"\n          ? theme.colors.dark[3]\n          : theme.colors.gray[5],\n    },\n  },\n  error: {\n    borderColor: \"red\",\n  },\n}));\n\nconst Preview = (props: {\n  fname: string;\n  fsize: number;\n  progress?: number;\n}) => {\n  return (\n    <Card p={0}>\n      <Stack align=\"center\" spacing=\"sm\" direction=\"row\" sx={{ padding: 8 }}>\n        <Stack align=\"center\">\n          <DocumentCheckIconOutline size=\"lg\" />\n        </Stack>\n        <Text lineClamp={1}>{props.fname}</Text>\n        <Text>{`(${prettyBytes(props.fsize)})`}</Text>\n      </Stack>\n      {props.progress !== undefined && (\n        <Progress value={props.progress} size=\"xs\" />\n      )}\n    </Card>\n  );\n};\n\nexport const DropzoneFileInputComponent = forwardRef(\n  (\n    {\n      disableDragAndDrop,\n      clearable,\n      multiple = false,\n      label,\n      placeholder,\n      description,\n      error,\n      value,\n      id,\n      onChange,\n      required,\n      getUploadURL,\n      className,\n      style,\n      ...restProps\n    }: FileInputComponentProps & {\n      id?: string;\n      required?: boolean;\n    },\n    ref: Ref<HTMLDivElement>,\n  ) => {\n    const { classes, cx } = useStyles();\n\n    const canonicalValue = value instanceof AirplaneFile ? [value] : value;\n\n    const { onDrop, uploads } = useUploadAirplaneFiles({\n      onChange,\n      onLoad: (file) =>\n        showNotification({\n          title: \"Upload successful\",\n          message: `${file.name} uploaded successfully`,\n          type: \"success\",\n        }),\n      onError: (file, e) =>\n        showNotification({\n          title: \"Upload failed\",\n          message: `${file.name} upload failed: ${\n            (e as { message: string }).message\n          }`,\n          type: \"error\",\n        }),\n      getUploadURL,\n    });\n    const effectiveFiles = uploads.length ? uploads : canonicalValue || uploads;\n    const dropzoneClassName = restProps.disabled\n      ? classes.disabled\n      : error\n      ? classes.error\n      : undefined;\n    // Omit clearable to avoid React warning on non-boolean attribute.\n    return (\n      <Stack spacing=\"xs\" sx={{ fontSize: 14 }}>\n        <Stack direction=\"row\" grow>\n          <Stack\n            direction=\"row\"\n            spacing=\"xs\"\n            sx={{ fontWeight: 500, color: COLORS.gray[7] }}\n          >\n            {typeof label === \"string\" ? (\n              <Input.Label htmlFor={id}>{label}</Input.Label>\n            ) : (\n              label\n            )}\n            {required && (\n              <Text color=\"red\" disableMarkdown>\n                *\n              </Text>\n            )}\n          </Stack>\n          <Stack align=\"end\">\n            {clearable && effectiveFiles.length > 0 && (\n              <XMarkIcon\n                style={{ cursor: \"pointer\" }}\n                onClick={() => {\n                  onChange([]);\n                }}\n              />\n            )}\n          </Stack>\n        </Stack>\n        <Dropzone\n          className={cx(className, dropzoneClassName)}\n          style={style}\n          onDrop={onDrop}\n          activateOnDrag={!disableDragAndDrop}\n          multiple={multiple}\n          ref={ref}\n          {...restProps}\n        >\n          <Stack align=\"center\">\n            <Dropzone.Accept>\n              <Stack align=\"center\">\n                <ArrowUpTrayIcon size=\"xl\" color=\"blue\" />\n              </Stack>\n              <Text color=\"blue\">{placeholder || \"Drop to upload\"}</Text>\n            </Dropzone.Accept>\n            <Dropzone.Reject>\n              <Stack align=\"center\">\n                <XMarkIcon size=\"xl\" color=\"red\" />\n              </Stack>\n              <Text color=\"red\">{placeholder || \"Drop to upload\"}</Text>\n            </Dropzone.Reject>\n            <Dropzone.Idle>\n              {effectiveFiles.length ? (\n                <Stack>\n                  {effectiveFiles.map(\n                    (\n                      f: AirplaneFile | { percent: number; file: AirplaneFile },\n                      i,\n                    ) =>\n                      f instanceof AirplaneFile ? (\n                        <Preview key={i} fname={f.name} fsize={f.size} />\n                      ) : (\n                        <Preview\n                          key={i}\n                          fname={f.file.name}\n                          fsize={f.file.size}\n                          progress={f.percent}\n                        />\n                      ),\n                  )}\n                </Stack>\n              ) : (\n                <>\n                  <Stack align=\"center\">\n                    <ArrowUpTrayIcon size=\"xl\" />\n                  </Stack>\n                  <Text>{placeholder || \"Click or drag to upload\"}</Text>\n                </>\n              )}\n            </Dropzone.Idle>\n          </Stack>\n        </Dropzone>\n        {typeof description === \"string\" ? (\n          <Text sx={{ color: COLORS.gray[6] }}>{description}</Text>\n        ) : (\n          description\n        )}\n        {typeof error === \"string\" ? <Text color=\"red\">{error}</Text> : error}\n      </Stack>\n    );\n  },\n);\n\nDropzoneFileInputComponent.displayName = \"FileInputComponent\";\n"],"names":["useStyles","createStyles","theme","disabled","backgroundColor","colorScheme","colors","dark","gray","borderColor","cursor","color","error","Preview","props","padding","fname","prettyBytes","fsize","progress","undefined","DropzoneFileInputComponent","disableDragAndDrop","clearable","multiple","label","placeholder","description","value","id","onChange","required","getUploadURL","className","style","restProps","ref","classes","cx","canonicalValue","AirplaneFile","onDrop","uploads","useUploadAirplaneFiles","onLoad","file","showNotification","title","message","name","type","onError","e","effectiveFiles","length","dropzoneClassName","fontSize","fontWeight","COLORS","map","f","i","size","percent","displayName"],"mappings":"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"}