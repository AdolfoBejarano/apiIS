{"version":3,"file":"ComponentErrorBoundary.js","sources":["../../../src/components/errorBoundary/ComponentErrorBoundary.tsx"],"sourcesContent":["import { uniqueId } from \"lodash-es\";\nimport hash from \"object-hash\";\nimport { Component, ErrorInfo, ReactNode } from \"react\";\n\nimport { getNPMPackageVersion } from \"getNPMPackageVersion\";\nimport { sendViewMessage } from \"message/sendViewMessage\";\n\nimport { ComponentErrorFallback } from \"./ComponentErrorFallback\";\nimport { LatestRun } from \"./LatestRunDetails\";\n\nexport type Props = {\n  children: ReactNode;\n  componentName: string;\n  fallback?: ReactNode;\n  latestRun?: LatestRun;\n};\n\nexport class ComponentErrorBoundary extends Component<\n  Props,\n  { error?: Error; errorInfo?: ErrorInfo; errorID?: string }\n> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  componentDidMount() {\n    const version = getNPMPackageVersion();\n\n    sendViewMessage({\n      type: \"component_mounted\",\n      componentName: this.props.componentName,\n      version,\n    });\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    const errorID = uniqueId();\n    this.setState({ error, errorInfo, errorID });\n    sendViewMessage({\n      type: \"console\",\n      id: errorID,\n      messageType: \"error\",\n      message: error.message,\n      component: this.props.componentName,\n      hash: hash(error),\n      time: Date.now(),\n    });\n  }\n\n  render() {\n    if (this.state.error && this.state.errorInfo && this.state.errorID) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n      return (\n        <ComponentErrorFallback\n          errorID={this.state.errorID}\n          error={this.state.error}\n          errorInfo={this.state.errorInfo}\n          componentName={this.props.componentName}\n          latestRun={this.props.latestRun}\n        />\n      );\n    } else {\n      return this.props.children;\n    }\n  }\n}\n"],"names":["ComponentErrorBoundary","Component","constructor","props","state","componentDidMount","version","getNPMPackageVersion","type","componentName","componentDidCatch","error","errorInfo","errorID","uniqueId","setState","id","messageType","message","component","hash","time","Date","now","render","fallback","latestRun","children"],"mappings":";;;;;;;AAiBO,MAAMA,+BAA+BC,UAG1C;AAAA,EACAC,YAAYC,OAAc;AACxB,UAAMA,KAAK;AACX,SAAKC,QAAQ;EACf;AAAA,EAEAC,oBAAoB;AAClB,UAAMC,UAAUC;AAEA,oBAAA;AAAA,MACdC,MAAM;AAAA,MACNC,eAAe,KAAKN,MAAMM;AAAAA,MAC1BH;AAAAA,IAAAA,CACD;AAAA,EACH;AAAA,EAEAI,kBAAkBC,OAAcC,WAAsB;AACpD,UAAMC,UAAUC;AAChB,SAAKC,SAAS;AAAA,MAAEJ;AAAAA,MAAOC;AAAAA,MAAWC;AAAAA,IAAAA,CAAS;AAC3B,oBAAA;AAAA,MACdL,MAAM;AAAA,MACNQ,IAAIH;AAAAA,MACJI,aAAa;AAAA,MACbC,SAASP,MAAMO;AAAAA,MACfC,WAAW,KAAKhB,MAAMM;AAAAA,MACtBW,MAAMA,KAAKT,KAAK;AAAA,MAChBU,MAAMC,KAAKC,IAAI;AAAA,IAAA,CAChB;AAAA,EACH;AAAA,EAEAC,SAAS;AACH,QAAA,KAAKpB,MAAMO,SAAS,KAAKP,MAAMQ,aAAa,KAAKR,MAAMS,SAAS;AAC9D,UAAA,KAAKV,MAAMsB,UAAU;AACvB,eAAO,KAAKtB,MAAMsB;AAAAA,MACpB;AAEE,aAAA,oBAAC,0BACC,SAAS,KAAKrB,MAAMS,SACpB,OAAO,KAAKT,MAAMO,OAClB,WAAW,KAAKP,MAAMQ,WACtB,eAAe,KAAKT,MAAMM,eAC1B,WAAW,KAAKN,MAAMuB,UACtB,CAAA;AAAA,IAAA,OAEC;AACL,aAAO,KAAKvB,MAAMwB;AAAAA,IACpB;AAAA,EACF;AACF;"}